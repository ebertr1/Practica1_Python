{% extends 'index.html' %}

{% block content %}
<div class="pagetitle">
  <div class="col-12 d-flex flex-column align-items-center">
    <h2 class="mt-4 text-black">LISTADO DE Proyectos</h2>
    <div class="d-flex justify-content-end w-100 mb-3">
      <a href="/admin/proyecto/register" class="btn btn-custom btn-success">Nuevo</a>
    </div>

    <div class="table-responsive w-75">
      <table class="table table-custom text-white">
        <thead>
          <tr>
            <th>Nro</th>
            <th>Nombre</th>
            <th>Inversión</th>
            <th>Duración</th>
            <th>Fecha Inicio</th>
            <th>Fecha Final</th>
            <th>Inversionistas</th>
            <th>Generación Diaria</th>
            <th>Costo Operativo</th>
            <th>Tipo Energía</th>
            <th>Ubicación</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% if list %}
            {% for item in list %}
            <tr id="row-{{ item.idProyecto }}">
              <td>{{ loop.index }}</td>
              <td>{{ item.nombre }}</td>
              <td>{{ item.inversion }}</td>
              <td>{{ item.duracion }}</td>
              <td>{{ item.fechaInicio }}</td>
              <td>{{ item.fechaFin }}</td>
              <td>{{ item.inversionistas }}</td>
              <td>{{ item.generacionDiaria }}</td>
              <td>{{ item.costoOperativo }}</td>
              <td>{{ item.tipoEnergia }}</td>
              <td>{{ item.ubicacion }}</td>
              <td>
                <a href="/admin/proyecto/edit/{{ item.idProyecto }}" class="btn btn-custom btn-info">Modificar</a>
                <button class="btn btn-danger" onclick="deleteProyecto({{ item.idProyecto }})">Eliminar</button>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="12" class="text-center">No hay proyectos registrados.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  function deleteProyecto(id) {
    if (confirm("¿Estás seguro de que deseas eliminar este proyecto?")) {
        fetch(`/admin/proyecto/delete/${id}`, { // Asegúrate de que la ruta API sea la correcta
            method: 'DELETE'
        })
        .then(response => {
            if (response.ok) {
                document.getElementById(`row-${id}`).remove(); // Eliminar la fila de la tabla
                alert("Proyecto eliminado exitosamente."); // Mensaje de éxito
            } else {
                alert("Error al eliminar el proyecto."); // Mensaje de error
            }
        })
        .catch(error => {
            console.error("Hubo un error:", error);
            alert("Se produjo un error al intentar eliminar el proyecto."); // Mensaje de error
        });
    }
  }
</script>

<style>
  /* Estilos CSS aquí, ajusta según tus necesidades */
</style>
{% endblock %}
